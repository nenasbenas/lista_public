<script>
    var hls = null; // Variável global para controlar o fluxo

    function toggleCanais() {
        var menu = document.getElementById('menu-canais');
        menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    }

    function playM3U8(url, nome) {
        var video = document.getElementById('video');
        var container = document.getElementById('video-container');
        
        // Exibe o container e prepara o vídeo
        container.style.display = 'block';
        video.muted = true; // Ajuda o navegador a permitir o autoplay
        
        console.log("Sintonizando: " + nome);

        // Se já existir um sinal rodando, a gente destrói ele para não travar
        if (hls) {
            hls.destroy();
        }

        if (Hls.isSupported()) {
            hls = new Hls({
                capLevelToPlayerSize: true,
                lowLatencyMode: true,
            });
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                // Tenta dar o play e se falhar, remove o mudo para o usuário clicar
                video.play().catch(function() {
                    video.muted = false;
                    video.controls = true;
                });
            });

            // Tratamento de erro de rede (comum em IPTV)
            hls.on(Hls.Events.ERROR, function (event, data) {
                if (data.fatal) {
                    if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                        hls.startLoad();
                    } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
                        hls.recoverMediaError();
                    }
                }
            });

        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // Suporte Nativo (Safari/iOS)
            video.src = url;
            video.addEventListener('loadedmetadata', function() {
                video.play();
            });
        }

        // Scroll suave para o vídeo
        setTimeout(() => {
            container.scrollIntoView({ behavior: 'smooth' });
        }, 300);
    }
</script>
