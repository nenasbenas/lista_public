<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LÃ‰O KAZAMA | INTELLIGENT VIP</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --neon: #00ffcc; --bg: #0a0a0a; --card: #151515; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { width: 90%; max-width: 800px; background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid rgba(0,255,204,0.2); box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        .video-wrapper { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 15px; overflow: hidden; margin-bottom: 20px; border: 1px solid #333; }
        video { width: 100%; height: 100%; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        select, input { background: #222; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 10px; font-size: 14px; }
        .btn-update { grid-column: span 2; background: var(--neon); color: #000; border: none; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .loading-overlay { display: none; text-align: center; color: var(--neon); font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; letter-spacing: 3px; margin-top: 0;">LÃ‰O KAZAMA VIP</h2>
    
    <div class="video-wrapper">
        <video id="mainVideo" controls></video>
    </div>

    <div class="controls">
        <button class="btn-update" onclick="forceUpdate()">ðŸ”„ FORÃ‡AR ATUALIZAÃ‡ÃƒO DA LISTA</button>
        
        <select id="repoList" onchange="smartLoad(this.value)">
            <option value="">ðŸ“‚ SELECIONE UMA LISTA</option>
            <option value="https://raw.githubusercontent.com/Ramys/Iptv-Brasil-2026/master/CanaisBR01.m3u8">Canais BR 01</option>
            <option value="https://raw.githubusercontent.com/Ramys/Iptv-Brasil-2026/master/CanaisBR02.m3u8">Canais BR 02</option>
            <option value="https://raw.githubusercontent.com/Ramys/Iptv-Brasil-2026/master/Lista%20Mundial1.m3u8">Mundial 01</option>
        </select>

        <input type="text" id="search" placeholder="ðŸ” Buscar canal..." onkeyup="filter()">
        
        <select id="channelList" style="grid-column: span 2;" onchange="play(this.value)">
            <option value="">ðŸ“º AGUARDANDO LISTA...</option>
        </select>
    </div>
    <div id="status" class="loading-overlay">PROCESSANDO...</div>
</div>

<script>
    const video = document.getElementById('mainVideo');
    const channelSelect = document.getElementById('channelList');
    const status = document.getElementById('status');
    let hls = new Hls();
    let currentData = [];

    // FunÃ§Ã£o para carregar de forma inteligente (usa cache se existir)
    async function smartLoad(url) {
        if (!url) return;
        
        const cached = localStorage.getItem(url);
        if (cached) {
            console.log("Usando lista do cache local...");
            parseM3U(cached);
            return;
        }

        await fetchData(url);
    }

    async function fetchData(url) {
        status.style.display = 'block';
        status.innerText = "CONTORNANDO BLOQUEIO DO GITHUB...";
        
        // RotaÃ§Ã£o de Proxies para nÃ£o ser banido
        const proxies = [
            `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
            `https://corsproxy.io/?${encodeURIComponent(url)}`
        ];

        for (let p of proxies) {
            try {
                const res = await fetch(p);
                const data = await res.json();
                const content = data.contents || data;
                
                if (content && content.includes("#EXTM3U")) {
                    localStorage.setItem(url, content); // Salva no cache para a prÃ³xima vez
                    parseM3U(content);
                    status.style.display = 'none';
                    return;
                }
            } catch (e) { console.warn("Proxy falhou, tentando o prÃ³ximo..."); }
        }
        
        alert("O GitHub ainda estÃ¡ bloqueando. Tente trocar de rede ou aguarde 5 min.");
        status.style.display = 'none';
    }

    function parseM3U(data) {
        const lines = data.split('\n');
        currentData = [];
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF')) {
                const name = lines[i].split(',')[1] || "Canal VIP";
                const link = lines[i+1]?.trim();
                if (link && link.startsWith('http')) currentData.push({ name, link });
            }
        }
        render(currentData);
    }

    function render(list) {
        channelSelect.innerHTML = `<option value="">âœ… ${list.length} CANAIS CARREGADOS</option>`;
        list.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c.link;
            opt.textContent = c.name;
            channelSelect.appendChild(opt);
        });
    }

    function filter() {
        const query = document.getElementById('search').value.toLowerCase();
        render(currentData.filter(c => c.name.toLowerCase().includes(query)));
    }

    function play(url) {
        if (!url) return;
        if (Hls.isSupported()) {
            hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
            video.src = url;
            video.play();
        }
    }

    function forceUpdate() {
        const currentUrl = document.getElementById('repoList').value;
        if (!currentUrl) return alert("Selecione uma lista primeiro!");
        localStorage.removeItem(currentUrl);
        fetchData(currentUrl);
    }
</script>

</body>
</html>
