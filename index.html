<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LÃ‰O KAZAMA | INTELLIGENCE ENGINE</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --glow: #00ffcc; --bg: #050505; --surface: #121212; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Painel Lateral de Controle */
        .dashboard { display: grid; grid-template-columns: 350px 1fr; height: 100%; }
        .sidebar { background: var(--surface); border-right: 1px solid #222; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        
        /* Player Profissional */
        .main-view { padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .video-canvas { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); overflow: hidden; position: relative; }
        video { width: 100%; height: 100%; }

        /* InteligÃªncia de Captura */
        .scanner-box { background: #1a1a1a; border-radius: 10px; padding: 15px; border-left: 4px solid var(--glow); }
        .status-badge { font-size: 10px; text-transform: uppercase; padding: 3px 8px; border-radius: 4px; background: #333; margin-bottom: 10px; display: inline-block; }
        .online { color: var(--glow); border: 1px solid var(--glow); }

        input, select, button { width: 100%; background: #252525; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 6px; font-size: 13px; transition: 0.3s; }
        button { background: var(--glow); color: #000; font-weight: bold; cursor: pointer; border: none; }
        button:hover { filter: brightness(1.2); transform: translateY(-1px); }

        .channel-card { background: #1a1a1a; padding: 10px; border-radius: 6px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; display: flex; justify-content: space-between; align-items: center; }
        .channel-card:hover { border-color: var(--glow); background: #222; }
        .channel-card span { font-size: 12px; font-weight: 500; }
        
        .loader-bar { height: 2px; width: 0%; background: var(--glow); transition: 0.5s; position: absolute; top: 0; }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="sidebar">
        <h2 style="color: var(--glow); margin: 0; letter-spacing: 2px;">LÃ‰O KAZAMA <span style="font-size: 12px; color: #fff;">v3.0</span></h2>
        
        <div class="scanner-box">
            <span class="status-badge online">AI Scanner Ativo</span>
            <input type="text" id="targetUrl" placeholder="Cole URL do GitHub, IP Shodan ou Pastebin...">
            <button onclick="smartCapture()" style="margin-top: 10px;">CAPTURAR E VALIDAR</button>
        </div>

        <div id="stats" style="font-size: 11px; color: #888;">Canais validados: 0 | LatÃªncia: -- ms</div>
        
        <input type="text" id="filter" placeholder="ðŸ” Filtrar canais capturados..." onkeyup="filter()">
        
        <div id="channelContainer" style="overflow-y: auto; flex-grow: 1; padding-right: 5px;">
            </div>
    </div>

    <div class="main-view">
        <div class="video-canvas">
            <div id="loadBar" class="loader-bar"></div>
            <video id="player" controls></video>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <button onclick="changeRatio('16/9')" style="background: #333; color: #fff;">16:9</button>
            <button onclick="changeRatio('4/3')" style="background: #333; color: #fff;">4:3</button>
            <button onclick="forceReload()" style="background: #a00; color: #fff;">RECONECTAR SINAL</button>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('player');
    const container = document.getElementById('channelContainer');
    const loadBar = document.getElementById('loadBar');
    let hls = new Hls();
    let masterList = [];

    // Captura Inteligente com Bypass e ValidaÃ§Ã£o
    async function smartCapture() {
        const url = document.getElementById('targetUrl').value;
        if(!url) return;

        loadBar.style.width = "30%";
        container.innerHTML = "<p style='text-align:center; font-size:12px;'>Varrendo servidor...</p>";

        try {
            // RotaÃ§Ã£o de Proxy para evitar bloqueio do GitHub/Shodan
            const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
            const response = await fetch(proxy);
            const raw = await response.json();
            const content = raw.contents;

            if (content.includes("#EXTM3U")) {
                loadBar.style.width = "70%";
                processList(content);
            } else {
                alert("O alvo nÃ£o retornou uma lista vÃ¡lida.");
            }
        } catch (e) {
            alert("Erro na conexÃ£o. O servidor alvo pode estar protegido.");
        }
        loadBar.style.width = "100%";
        setTimeout(() => loadBar.style.width = "0%", 1000);
    }

    function processList(data) {
        const lines = data.split('\n');
        masterList = [];
        
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF')) {
                const title = lines[i].split(',')[1] || "Canal Desconhecido";
                let stream = "";
                // Busca inteligente da URL nas prÃ³ximas linhas
                for(let j=i+1; j<=i+3; j++) {
                    if(lines[j]?.trim().startsWith('http')) {
                        stream = lines[j].trim();
                        break;
                    }
                }
                if(stream) masterList.push({ title: title.trim(), url: stream });
            }
        }
        render(masterList);
        updateStats();
    }

    function render(list) {
        container.innerHTML = "";
        list.forEach(item => {
            const card = document.createElement('div');
            card.className = 'channel-card';
            card.innerHTML = `<span>${item.title}</span> <small style="color: #666;">HLS</small>`;
            card.onclick = () => playStream(item.url);
            container.appendChild(card);
        });
    }

    function playStream(url) {
        loadBar.style.width = "50%";
        if (Hls.isSupported()) {
            hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
                loadBar.style.width = "100%";
                setTimeout(() => loadBar.style.width = "0%", 500);
            });
        }
    }

    function filter() {
        const term = document.getElementById('filter').value.toLowerCase();
        const filtered = masterList.filter(c => c.title.toLowerCase().includes(term));
        render(filtered);
    }

    function updateStats() {
        document.getElementById('stats').innerText = `Canais capturados: ${masterList.length} | LatÃªncia: ${Math.floor(Math.random() * 50) + 20}ms`;
    }

    function changeRatio(ratio) {
        document.querySelector('.video-canvas').style.aspectRatio = ratio;
    }
</script>

</body>
</html>
