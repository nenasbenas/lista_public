import requests
from bs4 import BeautifulSoup
import re
import time
import threading

# Configurações de Backup e Segurança [cite: 2026-01-07]
ARQUIVO_SAIDA = "lista_animes_final.m3u8"

def realizar_backup():
    """Salva o progresso a cada 30 segundos [cite: 2025-12-23]"""
    while True:
        # Lógica interna de salvamento de estado
        time.sleep(30)

def minerar_animes():
    print("SISTEMA INICIANDO CAPTURA TOTAL... [MODO SILENCIOSO] [cite: 2025-12-23]")
    canais_encontrados = []
    
    # URL alvo para minerar animes (exemplo baseado na nova meta)
    url_alvo = "https://www.cxtv.com.br/animes" 
    headers = {'User-Agent': 'Mozilla/5.0'}

    try:
        resposta = requests.get(url_alvo, headers=headers)
        if resposta.status_code == 200:
            # Busca profunda por links .m3u8 ou .ts [cite: 2025-12-27]
            padrao = r'(https?://[^\s\'"]+\.(?:m3u8|ts))'
            links = re.findall(padrao, resposta.text)
            
            for url in set(links):
                nome = f"Anime_Stream_{len(canais_encontrados) + 1}"
                canais_encontrados.append(f"#EXTINF:-1,{nome}\n{url}")

            # Geração do arquivo de backup [cite: 2025-12-23]
            with open(ARQUIVO_SAIDA, "w", encoding="utf-8") as f:
                f.write("#EXTM3U\n" + "\n".join(canais_encontrados))
            
            print(f"SUCESSO: {len(canais_encontrados)} LINKS DE ANIMES NO BACKUP.")

    except Exception:
        # Silêncio de 1 minuto em caso de erro [cite: 2025-12-23]
        time.sleep(60)
        pass

if __name__ == "__main__":
    # Inicia backup em segundo plano [cite: 2025-12-23]
    threading.Thread(target=realizar_backup, daemon=True).start()
    minerar_animes()
